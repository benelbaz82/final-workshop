    name: "Terraform CI/CD"

    on:
      push:
        branches:
          - main # Trigger on pushes to the main branch
        paths:
          - 'terraform/**' # Only run if changes are in the terraform directory
      pull_request:
        branches:
          - main # Trigger on pull requests targeting the main branch
        paths:
          - 'terraform/**'

    jobs:
      terraform:
        runs-on: ubuntu-latest # Specify the runner environment
        steps:
          - name: Checkout code
            uses: actions/checkout@v4 # Action to checkout your repository code

          - name: Setup Terraform
            uses: hashicorp/setup-terraform@v3 # Action to set up Terraform CLI
            with:
              terraform_version: 1.x.x # Specify your desired Terraform version

          - name: Terraform Init
            id: init
            run: terraform init
            working-directory: ./terraform # Specify the directory containing your Terraform files

          - name: Terraform Format Check
            id: fmt
            run: terraform fmt -check
            working-directory: ./terraform

          - name: Terraform Validate
            id: validate
            run: terraform validate
            working-directory: ./terraform

          - name: Terraform Plan
            id: plan
            if: github.event_name == 'pull_request' # Only run plan on pull requests
            run: terraform plan -no-color -input=false
            working-directory: ./terraform
            env:
              AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }} # Example: Provide cloud credentials
              AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

          - name: Terraform Apply
            id: apply
            if: github.event_name == 'push' && github.ref == 'refs/heads/main' # Only apply on pushes to main
            run: terraform apply -auto-approve -input=false
            working-directory: ./terraform
            env:
              AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
              AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
